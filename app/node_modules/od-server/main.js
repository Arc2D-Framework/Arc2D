var http = require('http');
var url = require('url');
var querystring = require('querystring');
var fs = require('fs');
path = require("path");

var port = process.argv[2];
console.log("port", port);

var certOptions = {
    // key: fs.readFileSync(__dirname+"/../.." + '/ssl/server.key'),
    // cert: fs.readFileSync(__dirname+"/../.." + '/ssl/server.crt')
}

mimetypes = {

    "css":"text/css",
    "html":"text/html",
    "ico":"image/ico",
    "jpg":"image/jpeg",
    "js":"text/javascript",
    "json":"application/json",
    "png":"image/png",
    "mjs" : "text/javascript"
  };

http.createServer(certOptions,function(request, response){
  var pathName= url.parse(request.url).pathname;
  // console.log("pathName",pathName)
    if (pathName == "" || pathName == "/") {
        request.url = "/index.html";
    }

   pathName = url.parse(request.url).pathname;
   var fp = __dirname+"/../.."+pathName;
   var mime="";
   if(pathName.indexOf(".mjs") >=0||pathName.indexOf(".js") >=0){
       mime = "text/javascript"
   } else {
       mime = ""
   }
   fs.readFile(fp, function(err, data){
       console.log("request for:", fp)
      if(err){
        response.writeHead(404, {'Content-type':'text/plan'});
        response.write('Page Was Not Found');
        response.end();
       } else {
        // response.writeHead(200,{'Content-type':mime});
        var mType = mimetypes[path.extname(request.url).split(".")[1]];
        // console.log("mimetype",mimetypes[path.extname(request.url).split(".")[1]]||"")
        response.writeHead(200, {'Content-Type':mType||""});
        response.write(data);
        response.end();
       }
   })
}).listen(port);
console.log("Server is listening: " + port);
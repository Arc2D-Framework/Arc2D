function qFactory(e,n){function t(e,n,r){var o;if(e)if(i(e))for(o in e)"prototype"==o||"length"==o||"name"==o||e.hasOwnProperty&&!e.hasOwnProperty(o)||n.call(r,e[o],o);else if(e.forEach&&e.forEach!==t)e.forEach(n,r);else if(u(e))for(o=0;o<e.length;o++)n.call(r,e[o],o);else for(o in e)e.hasOwnProperty(o)&&n.call(r,e[o],o);return e}function r(e){return e}function o(e){return l(e)}function a(e){var n=c(),r=0,o=u(e)?[]:{};return t(e,function(e,t){r++,f(e).then(function(e){o.hasOwnProperty(t)||(o[t]=e,--r||n.resolve(o))},function(e){o.hasOwnProperty(t)||n.reject(e)},function(e){o.hasOwnProperty(t)||n.notify(e)})}),0===r&&n.resolve(o),n.promise}var s={}.toString,i=function(e){return"function"==typeof e},u=function(e){return"[object Array]"===s.call(e)},c=function(){var t,a,s=[];return a={resolve:function(n){if(s){var r=s;s=void 0,t=f(n),r.length&&e(function(){for(var e,n=0,o=r.length;o>n;n++)e=r[n],t.then(e[0],e[1],e[2])})}},reject:function(e){a.resolve(d(e))},notify:function(n){if(s){var t=s;s.length&&e(function(){for(var e,r=0,o=t.length;o>r;r++)e=t[r],e[2](n)})}},promise:{then:function(e,a,u){var f=c(),l=function(t){try{f.resolve((i(e)?e:r)(t))}catch(o){f.reject(o),n(o)}},d=function(e){try{f.resolve((i(a)?a:o)(e))}catch(t){f.reject(t),n(t)}},h=function(e){try{f.notify((i(u)?u:r)(e))}catch(t){n(t)}};return s?s.push([l,d,h]):t.then(l,d,h),f.promise},"catch":function(e){return this.then(null,e)},"finally":function(e){function n(e,n){var t=c();return n?t.resolve(e):t.reject(e),t.promise}function t(t,o){var a=null;try{a=(e||r)()}catch(s){return n(s,!1)}return a&&i(a.then)?a.then(function(){return n(t,o)},function(e){return n(e,!1)}):n(t,o)}return this.then(function(e){return t(e,!0)},function(e){return t(e,!1)})}}}},f=function(n){return n&&i(n.then)?n:{then:function(t){var r=c();return e(function(){r.resolve(t(n))}),r.promise}}},l=function(e){var n=c();return n.reject(e),n.promise},d=function(t){return{then:function(r,a){var s=c();return e(function(){try{s.resolve((i(a)?a:o)(t))}catch(e){s.reject(e),n(e)}}),s.promise}}},h=function(t,a,s,u){var d,h=c(),v=function(e){try{return(i(a)?a:r)(e)}catch(t){return n(t),l(t)}},p=function(e){try{return(i(s)?s:o)(e)}catch(t){return n(t),l(t)}},y=function(e){try{return(i(u)?u:r)(e)}catch(t){n(t)}};return e(function(){f(t).then(function(e){d||(d=!0,h.resolve(f(e).then(v,p,y)))},function(e){d||(d=!0,h.resolve(p(e)))},function(e){d||h.notify(y(e))})}),h.promise};return{defer:c,reject:l,when:h,all:a}}window.q=qFactory(function(e){setTimeout(function(){e()},0)},function(e){console.error("qLite: "+e.stack)});var kontra=function(e){var n=/(jpeg|jpg|gif|png)$/,t=/(wav|mp3|ogg|aac|m4a)$/;e.images={},e.audios={},e.data={},e.assetPaths={images:"",audios:"",data:""};var r=new Audio;return e.canUse=e.canUse||{},e.canUse.wav="",e.canUse.mp3=r.canPlayType("audio/mpeg;").replace(/^no$/,""),e.canUse.ogg=r.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),e.canUse.aac=r.canPlayType("audio/aac;").replace(/^no$/,""),e.canUse.m4a=(r.canPlayType("audio/x-m4a;")||e.canUse.aac).replace(/^no$/,""),e.getAssetExtension=function(e){return e.substr((~-e.lastIndexOf(".")>>>0)+2)},e.getAssetType=function(e){var r=this.getAssetExtension(e);return r.match(n)?"Image":r.match(t)?"Audio":"Data"},e.getAssetName=function(e){return e.replace(/\.[^/.]+$/,"")},e}(kontra||{}),kontra=function(e,n){return e.loadAssets=function(){var t,r,o=n.defer(),a=[],s=0,i=arguments.length;arguments.length||o.resolve();for(var u,c=0;u=arguments[c];c++)r=Array.isArray(u)?u[0]:u,t=this.getAssetType(r),function(n){a.push(n.promise),e["load"+t](r).then(function(){n.resolve(),o.notify({loaded:++s,total:i})},function(e){n.reject(e)})}(n.defer());return n.all(a).then(function(){o.resolve()},function(e){o.reject(e)}),o.promise},e.loadImage=function(t){var r=n.defer(),o=this.getAssetName(t),a=new Image;return t=this.assetPaths.images+t,a.onload=function(){e.images[o]=e.images[t]=this,r.resolve(this)},a.onerror=function(){r.reject("Unable to load image "+t)},a.src=t,r.promise},e.loadAudio=function(t){var r,o,a,s,i=n.defer();Array.isArray(t)||(t=[t]);for(var u=0;r=t[u];u++)if(this.canUse[this.getAssetExtension(r)]){a=r;break}return a?(o=this.getAssetName(a),s=new Audio,r=this.assetPaths.audios+a,s.addEventListener("canplay",function(){e.audios[o]=e.audios[r]=this,i.resolve(this)}),s.onerror=function(){i.reject("Unable to load audio "+r)},s.src=r,s.preload="auto",s.load()):i.reject("Browser cannot play any of the audio formats provided"),i.promise},e.loadData=function(t){var r=n.defer(),o=new XMLHttpRequest,a=this.getAssetName(t),s=this.assetPaths.data+t;return o.addEventListener("load",function(){if(200!==o.status)return void r.reject(o.responseText);try{var n=JSON.parse(o.responseText);e.data[a]=e.data[s]=n,r.resolve(n)}catch(t){var i=o.responseText;e.data[a]=e.data[s]=i,r.resolve(i)}}),o.open("GET",s,!0),o.send(),r.promise},e}(kontra||{},q),kontra=function(e,n){return e.bundles={},e.createBundle=function(e,n){this.bundles[e]||(this.bundles[e]=n||[])},e.loadBundles=function(){for(var e,t,r=n.defer(),o=[],a=0,s=0,i=0;t=arguments[i];i++)(e=this.bundles[t])?(s+=e.length,o.push(this.loadAssets.apply(this,e))):r.reject("Bundle '"+t+"' has not been created.");return n.all(o).then(function(){r.resolve()},function(e){r.reject(e)},function(){r.notify({loaded:++a,total:s})}),r.promise},e}(kontra||{},q),kontra=function(e,n){return e.loadManifest=function(t){var r,o=n.defer();return e.loadData(t).then(function(n){e.assetPaths.images=n.imagePath||"",e.assetPaths.audios=n.audioPath||"",e.assetPaths.data=n.dataPath||"";for(var t,a=0;t=n.bundles[a];a++)e.createBundle(t.name,t.assets);return n.loadBundles?(r="all"===n.loadBundles?Object.keys(e.bundles||{}):Array.isArray(n.loadBundles)?n.loadBundles:[n.loadBundles],void e.loadBundles.apply(e,r).then(function(){o.resolve()},function(e){o.reject(e)},function(e){o.notify(e)})):void o.resolve()},function(e){o.reject(e)}),o.promise},e}(kontra||{},q);
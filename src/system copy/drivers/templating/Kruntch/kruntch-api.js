!function(e,t){function r(e){return" "==e||"\r"==e||"\n"==e?!0:!1}function n(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e?!0:!1}function a(e){return e>="0"&&"9">=e?!0:!1}function s(e){return 1==n(e)||1==a(e)?!0:!1}function o(e){return":"==e||"_"==e||"-"==e||"!"==e||1==s(e)?!0:!1}function l(e){return/^\d+$/.test(e)}function f(e){return!isNaN(parseFloat(e))&&isFinite(e)}function u(e){return e.slice(0)}function h(e,t){var r={};for(m in e)r[m]=e[m];for(m in t)r[m]=t[m];return r}function c(e){return h({},e)}function v(e){var t=c(e);t.sub={};for(var r in e.sub)t.sub[r]=v(e.sub[r]);return t}function p(e,t,r,n){var i,a=e+"",s=-1;if("string"==typeof t){if(!n)return e.split(t).join(r);for(i=t.toLowerCase();-1!==(s=a.toLowerCase().indexOf(t,s>=0?s+r.length:0));)a=a.substring(0,s)+r+a.substring(s+t.length)}return a}function d(e){return e.indexOf("&")>-1&&(e=p(e,"&amp;","&",!0),e=p(e,"&lt;","<",!0),e=p(e,"&gt;",">",!0)),e}function g(e){var r=e.split(".");return r==t||null==r||0==r.length?"":r[r.length-1]}function w(e,r){for(var n=e,i=r.split("."),a=0;a<i.length;a++)n=e,e=e[i[a]],"function"==typeof e&&(e=e.call(n));return(e==t||null==e)&&(e=""),e}function y(e,t,r){return new Function("return ("+e.root.conditions[r]+")").call(t)}function b(e,t,r){return new Function("return ("+e.root.wheres[r]+")").call(t)}function x(e,r,n,i){var a={items:[],names:[],lookup:{},at:function(e){return 1==f(e)?this.items[e]:this.lookup[e]}},s=w(r,n);if(s==t)return a;var o=[];if(!(s instanceof Array)){var l=[];o=[];for(var h in s)o.push(h),l.push(s[h]);s=l}if(i!=t){for(var c=new Function("return ("+e.root.wheres[i]+")"),m=[],v=[],p=0;p<s.length;p++){var d=s[p],g=o[p];d.Root=r.Root,d.Parent=r,d.Parents=u(r.Parents),d.Parents.push(r),oitem.Family=r.Family,1==c.call(d)&&(m.push(d),null!=g&&null!=g&&v.push(g))}s=m,o=v}a.items=s,a.names=o;for(var y=0;y<a.names.length;y++)a.lookup[a.names[y]]=a.items[y];return a}function A(e){var r={any:t,first:t,last:t,empty:t,nth:[]};for(var n in e.sub){var i=e.sub[n];if(i.host=e,"first"==i.name)r.first=i;else if("last"==i.name)r.last=i;else if("empty"==i.name)r.empty=i;else if("nth"==i.name){r.nth.push({template:i,every:t,at:t,where:t});var a=r.nth[r.nth.length-1];if(a.every=i.attrs.every,a.at=i.attrs.at,a.where=i.attrs.where,a.at!=t&&a.at.indexOf(",")>-1){var s=a.at.split(",");a.at=s[0];for(var o=1;o<s.length;o++)r.nth.push({template:v(i),every:a.every,at:s[o],where:a.where})}}}r.any=c(e),r.any.host=e,r.any.sub={};for(var n in e.sub){var i=e.sub[n];"first"==i.name||"last"==i.name||"empty"==i.name||"nth"==i.name?r.any.text=p(r.any.text,n,"",!0):r.any.sub[n]=i}return r.first!=t||r.last!=t||r.empty!=t||r.nth.length>0?r.hasTargets=!0:r.hasTargets=!1,r}function k(e,r,n,i){e.details==t&&(e.details=A(e));var a=t;if(1==e.details.hasTargets)if(e.details.first!=t&&0==r)a=e.details.first;else if(e.details.last!=t&&r==n-1)a=e.details.last;else if(e.details.empty!=t&&-1==r&&0==n)a=e.details.empty;else for(var s=0;s<e.details.nth.length;s++){if(e.details.nth[s].every!=t&&r%e.details.nth[s].every==0){if(e.details.nth[s].where!=t&&0==b(e,i,e.details.nth[s].where))continue;a=e.details.nth[s].template;break}if(e.details.nth[s].at!=t&&r==e.details.nth[s].at){if(e.details.nth[s].where!=t&&0==b(e,i,e.details.nth[s].where))continue;a=e.details.nth[s].template;break}if(e.details.nth[s].where!=t&&1==b(e,i,e.details.nth[s].where)){a=e.details.nth[s].template;break}}return a==t&&n>0&&(a=e.details.any),a}function O(e){var r={first:t,last:t,empty:t,nth:[]};for(var n in e.sub){var i=e.sub[n];if(i.host=e,"first"==i.name)r.first=i;else if("last"==i.name)r.last=i;else if("empty"==i.name)r.empty=i;else if("nth"==i.name){r.nth.push({template:i,at:t});var a=r.nth[r.nth.length-1];if(a.at=i.attrs.at,a.at!=t&&a.at.indexOf(",")>-1){var s=a.at.split(",");a.at=s[0];for(var o=1;o<s.length;o++)r.nth.push({template:v(i),at:s[o]})}}}return r}function N(e){var t=null;if(1==y(e,e.view,e.attrs.condition)){t=c(e),t.sub={};for(var r in e.sub){var n=e.sub[r];"elseif"==n.name||"else"==n.name?t.text=p(t.text,r,"",!0):t.sub[r]=n}}else{var a=[];for(var r in e.sub){var n=e.sub[r];if("elseif"==n.name)a.push(n);else if("else"==n.name){a.push(n);break}}for(i=0;i<a.length;i++){if("else"==a[i].name){t=a[i];break}if(1==y(e,e.view,a[i].attrs.condition)){t=a[i];break}}}return null!=t?H(t,e.view):""}function T(e){var r="",n=x(e,e.view,e.attrs.each,e.attrs.where);if(n.items.length>0)for(var i=0;i<n.items.length;i++){var a=n.items[i];if(null!=a&&a!=t){var s=a.toString(),o=n.names!=t&&n.names.length>0?n.names[i]:(i+1).toString(),l=s!=t&&s!={}.toString()?s:"",f=k(e,i,n.items.length,a);if(f!=t){var u={familyName:g(e.attrs.each)};f.index=o,f.count=n.items.length,f.str=l,r+=H(f,a,u)}}}else{var f=k(e,-1,0,null);f!=t&&(f.index=-1,f.count=0,f.str="",r+=H(f,e.view))}return r}function F(e){var r="",n=x(e,e.view,e.attrs["in"],e.attrs.where);if(e.details==t&&(e.details=O(e)),n.items.length>0)for(var i=0;i<e.details.nth.length;i++){var a=n.at(e.details.nth[i].at);if(null!=a&&a!=t){var s=a.toString(),o=e.details.nth[i].at,l=s!=t&&s!={}.toString()?s:"",f=e.details.nth[i].template,u={familyName:g(e.attrs["in"])};f.index=o,f.count=n.items.length,f.str=l,r+=H(f,a,u)}}else{var f=e.details.empty;f!=t&&(f.index=-1,f.count=0,f.str="",r+=H(f,e.view))}return r}function _(e){var r=w(e.view,e.attrs.to);if(r==t)return"";var n={familyName:g(e.attrs.to)};return H(e,r,n)}function P(e,n,i){var a=0,s=0,l=i.text,f={name:"",root:e.root,parent:e,view:t,text:"",attrs:{},sub:{}};for("<"==l.charAt(a)&&a++;a<l.length&&1==r(l.charAt(a));)a++;for(;a<l.length&&1==o(l.charAt(a));)f.name+=l.charAt(a++);for(f.name=f.name.toLowerCase();a<l.length;){for(var u="";a<l.length&&1==r(l.charAt(a));)a++;if("/"==l.charAt(a)||">"==l.charAt(a))break;for(;a<l.length&&1==o(l.charAt(a));)u+=l.charAt(a++);for(u=u.toLowerCase();a<l.length&&1==r(l.charAt(a));)a++;if("="==l.charAt(a)){for(a++;a<l.length&&1==r(l.charAt(a));)a++;if('"'==l.charAt(a)||"'"==l.charAt(a)){var h=l.charAt(a);a++,s=l.indexOf(h,a),f.attrs[u]=l.slice(a,s).trim(),a=s+1}}}if(a==l.length||">"==l.charAt(a))for(;1==n.HasMoreTokens();){if(i=n.NextToken(),1==i.iskeyelement){if(0!=i.isend)break;var c="_k1_st_"+(f.root.baseid++).toString();f.sub[c]=P(f,n,i),i={text:c,iskeyelement:!1}}f.text+=i.text}return f}function S(e){var t=new z(e.pre);for(e.text="",e.sub={};1==t.HasMoreTokens();){var r=t.NextToken();if(1==r.iskeyelement){var n="_k1_st_"+(e.baseid++).toString();e.sub[n]=P(e,t,r),r={text:n,iskeyelement:!1}}e.text+=r.text}return e}function j(e){e.properties=new Object,e.scripts=new Object,e.code=new Object,e.conditions=new Object,e.wheres=new Object,e.pre=e.raw;for(var t,n;(t=e.pre.indexOf("{{"))>=0;){var i="_k1_"+(e.baseid++).toString();n=e.pre.indexOf("}}",t);var a=e.pre.slice(t,n+2);e.pre=[e.pre.slice(0,t),i,e.pre.slice(n+2)].join(""),e.scripts[i]=d(a.trim())}for(t=0;(t=e.pre.indexOf("[",t))>=0;){n=e.pre.indexOf("]",t);var s=e.pre.slice(t,n+1);if(0==l(s.substring(1,s.length-1).trim())){var i="_k1_"+(e.baseid++).toString();e.pre=[e.pre.slice(0,t),i,e.pre.slice(n+1)].join(""),e.properties[i]=s.trim()}else t=n}for(;(t=e.pre.indexOf("{"))>=0;){var i="_k1_"+(e.baseid++).toString();n=e.pre.indexOf("}",t);var o=e.pre.slice(t,n+1);e.pre=[e.pre.slice(0,t),i,e.pre.slice(n+1)].join(""),e.code[i]=d(o.trim())}return this.parsePropCodes=function(i){var a=new Object;for(t=0;(t=e.pre.indexOf(i,t))>=0;){for(;0==r(e.pre.charAt(t))&&"="!=e.pre.charAt(t);)t++;for(;1==r(e.pre.charAt(t));)t++;if("="==e.pre.charAt(t)){for(t++;1==r(e.pre.charAt(t));)t++;if('"'==e.pre.charAt(t)||"'"==e.pre.charAt(t)){var s=e.pre.charAt(t);t++,n=e.pre.indexOf(s,t);var o="_k1_"+(e.baseid++).toString(),l=e.pre.slice(t,n);e.pre=[e.pre.slice(0,t),o,e.pre.slice(n)].join(""),a[o]=d(l.trim())}}}return a},e.conditions=this.parsePropCodes("condition"),e.wheres=this.parsePropCodes("where"),e}function R(e,r){var n={tio:r,baseid:(new Date).getTime(),name:"root",raw:t,pre:t,root:t,parent:t,view:t,text:"",sub:{}};n.root=n;var i=/^[a-z0-9]+$/i;return 1==i.test(e)?n.raw=r.Read(e):n.raw=e,n=j(n),n=S(n)}function C(r,n,i,a){(a==t||null==a)&&(a={}),a.Root=i.root!=t?i.root.view:t,a.Parent=i.parent!=t?i.parent.view:t,i.parent!=t&&i.parent.view!=t&&i.parent.view.Parents!=t?(a.Parents=u(i.parent.view.Parents),a.Parents.push(i.parent.view)):a.Parents=[];var s=a;if(i.bindings==t){i.bindings=[];for(var o in r)i.text.indexOf(o)>=0&&(i.bindings.push(o),i.text=p(i.text,o,"",!0))}s=h(s,n),s.Ready=t;for(var l=0;l<i.bindings.length;l++){var o=i.bindings[l],f=r[o];f=f.substring(2,f.length-2).trim(),f="return {"+f+"}",s=h(s,new Function(f).call(s))}return s.familyName!=t&&null!=s.familyName&&i.parent!=t?(1==e.depluralize&&"s"==s.familyName.charAt(s.familyName.length-1)&&(s.familyName=s.familyName.substring(0,s.familyName.length-1)),s.Family=i.parent.view.Family!=t?h({},i.parent.view.Family):{},s.Family[s.familyName]=s):s.Family==t&&(s.Family={}),s}function H(e,r,n){e.view=C(e.root.scripts,r,e,n),e.host!=t&&(e.host.view=e.view);var i=e.text.toString();for(var a in e.sub){var s="",o=e.sub[a];o.view=e.view,"if"==o.name?s=N(o):"for"==o.name?s=T(o):"with"==o.name?s=F(o):"apply"==o.name&&(s=_(o)),i=p(i,a,s,!0)}for(var l in e.root.code)if(i.indexOf(l)>=0){var f=e.root.code[l];f=f.substring(1,f.length-1),i=p(i,l,new Function(f).call(e.view),!0)}for(var u in e.root.properties)if(i.indexOf(u)>=0){var h=e.root.properties[u];h=h.substring(1,h.length-1).trim(),i="#"==h?p(i,u,e.index,!0):"##"==h?p(i,u,e.count,!0):"$"==h?p(i,u,e.str,!0):p(i,u,w(e.view,h),!0)}return i}function L(e,r,n){var i=R(e,n),a=H(i,r);return n!=t&&null!=n&&n.Write(e,a),i.view.Ready!=t&&i.view.Ready.call(i.view),a}var M={"if":!0,"for":!0,"with":!0,elseif:!0,"else":!0,first:!0,last:!0,nth:!0,empty:!0,apply:!0,to:!0},z=function(e){function n(){return a>=s.length?!1:!0}function i(){if(0==this.HasMoreTokens())return{text:"",iskeyelement:!1};for(var e="";a<s.length;){for(var n=!1,i=0;a<s.length&&"<"!=s.charAt(a);)e+=s.charAt(a++);for(i=a,i++;i<s.length&&1==r(s.charAt(i));)i++;if("/"==s.charAt(i))for(n=!0,i++;i<s.length&&1==r(s.charAt(i));)i++;for(var l="";i<s.length&&1==o(s.charAt(i))&&">"!=s.charAt(i);)l+=s.charAt(i++);if(l=l.trim(),1==M[l]){if(""!=e)return{text:e,iskeyelement:!1};for(a=i,e="<"+(1==n?"/":"")+l;a<s.length&&">"!=s.charAt(a);)e+=s.charAt(a++);return e+=">",a++,{text:e,iskeyelement:!0,isend:n}}a=i,""!=l&&l!=t&&null!=l&&(e+="<"+(1==n?"/":"")+l)}return{text:e,iskeyelement:!1}}var a=0,s=e;return{HasMoreTokens:n,NextToken:i}},W=function(e){function r(e,t){e.innerHTML=t}function n(n,i){return e!=t&&null!=e?e.Write!=t?void e.Write(i):void r(e,i):void 0}function i(r){if(e!=t&&e.Read!=t)return e.Read(r);for(var n=document.getElementsByTagName("*"),i=0;i<n.length;i++){var a=n[i].getAttribute("data-templateid");if(a!=t&&null!=a&&a==r)return"TEXTAREA"==n[i].nodeName.toUpperCase()?n[i].value:n[i].innerHTML}return""}return{Read:i,Write:n}};e.depluralize=!0,e.Apply=function(e,r,n,i,a){var s="";try{s=L(e,r,new W(n)),i!=t&&i(s)}catch(o){null!=a&&a(o)}return s},e.ApplyAsynch=function(t,r,n){return new Promise(function(i,a){window.setTimeout(function(){e.Apply(t,r,n,i,a)},1)})},e.Bind=function(e,t){var r=R(e,new W(document,{}));return C(r.root.scripts,t,r)}}(window.Kruntch=window.Kruntch||{});
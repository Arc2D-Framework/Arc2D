<template>
    <div>


        <div style="display: flex;flex-direction: row;flex-wrap: nowrap;" id="intro">
          <div style="width: 50%;padding: 22px;">
            <h1 id="api-reference">Events</h1>
            <p>Here's a minimalistic toggle-button created with html, css and native javascript. It slides left to right
            but gives no indication of being "on" or "off". In this exercise, we'll leverage the signals being emitted by
        components to demonstrate how components on screen can inter-communicate with themselves, siblings and parents.</p>
            <toggle-button></toggle-button>

            <h3 id="bubble">Event Bubbling</h3>
            <p>
                Events are like signals fired in the environment. Any component, including the component closest to, or responsible for the signal can listen for it. Arc leverages native event-bubbling, a mechanism recommended by w3c for loose coupling and communication. First look at this diagram:
                <img src="Src/docs/images/event_bubbling.png"/>
            </p>
            <p>
                It depicts a wireframe of the <code>toggle-button</code> component and shows the 'click' signal bubbling from the target (the knob), to all parents, ultimately ending at the Application (the body). The signal hops from parent to parent, giving each parent a chance to listen for and/or stop the event from further propagation through the DOM.
            </p>
            <p>
                By this bubbling mechanism, the <code>toggle-button</code> component is able to listen for <code>'click'</code> singnals being emmitted from its inner knob, as seen in the code snippet to the right. The event was never stopped, meaning, at the Application level, one could wire a universal 'click' listener and eventually be notified that some target (a knob), fired a 'click' signal. Imagine if the signals had more data in the payload as it traveled? The Application could intelligently record metrics and logs of how the app is being used.
            </p>
            <!-- <simple-calculator style="margin-top:30px;"></simple-calculator> -->
          </div>
          <div style="width: 50%;display: block;">
            <div class="shell lang"></div>
            <div class="javascript lang">
                <blockquote class="javascript" style="display:block;width: 100%;">
            From any JavaScript class:
          </blockquote>
          <pre class="highlight javascript" style="display:block;width: 100%;"><code>
namespace \`docs.demos.ui\` (
  class ToggleButton extends w3c.ui.WebComponent  {
    onConnected(){
            super.onConnected();
            this.addEventListener("click", e => this.onClick(e));
            this.knob = this.querySelector("div");
            this.direction = -1;
        }

        onStyleComputed(style){//wait for styles
            this.bounds = this.getBoundingClientRect();
            this.knob_bounds = this.knob.getBoundingClientRect();
        }


        onClick(){
            this.direction *= -1;
            this.onRender();
        }

        get x() {
            return this.direction > 0 ?
                this.bounds.width-this.knob_bounds.width-6 : 0;
        }

        onRender(){
            var vector = {x: this.x, y:0, z:0 }
            this.knob.style.transform = \`
                translate3d(\${vector.x}px, 0px, 0px)
            \`;
        }
  }
)
        </code></pre>
            </div>
            <div class="html lang">
                <blockquote class="html" style="display:block;width: 100%;">
            Toggle buttons template:
          </blockquote>
          <pre class="highlight html" style="display:block;width: 100%;"><code>
&#x3C;template&#x3E;
    &#x3C;div&#x3E;&#x3C;/div&#x3E;
&#x3C;/template&#x3E;
          </code></pre>
            </div>
            <div class="css lang">
                <blockquote class="css" style="display:block;width: 100%;">
            Toggle buttons css:
          </blockquote>
          <pre class="highlight css" style="display:block;width: 100%;"><code>

toggle-button {
    width: 70px;
    height: 30px;
    display: block;
    background: lightgray;
    border-radius: 30px;
    box-sizing: content-box;
    padding: 3px;
}

toggle-button div {
    transition: all .2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    width: 30px;
    background: white;
    box-sizing: border-box;
    height: 100%;
    border-radius: 50%;
}

toggle-button.on div {
    transform: translate3d(0px,0px,0px);
}
          </code></pre>
            </div>
          </div>
        </div>












        <div style="display: flex;flex-direction: row;flex-wrap: nowrap;" id="component-events-inter-communication">
          <div style="width: 50%;padding: 22px;">
            <h1>Inter-communication</h1>
            <p>Or, components that communicate with themselves internally. They listen to events being fired
            from within and respond. The first problem with this toggle-button is that it should set an attribute
            on itself when it is on/off. Perferrably a className. Inspect the button, toggle it, the only state
            that changes is a 3D translation along the x-axis. The full source of the class reveals that it
            already is listening to click events from within itself, firing the <code>onClick()</code> handler
            each time.
            <pre class="inline javascript lang"><code>
onConnected(){
    super.onConnected();
    this.addEventListener("click", e => this.onClick(e));
    ...
}
            </code></pre>
            </p>
            <p>It's important to note, that events are wired by the toggle button itself (<code>this</code>), via
                the w3c native api <code>addEventListener()</code>. <code>onClick()</code> is now bound to this event/signal
            and is all scoped and insolated within this component.</p>
            <p>
 <pre class="inline javascript lang"><code>
onClick(){
    this.direction *= -1;
    this.onRender();
}
            </code></pre>               
            </p>
            <p>
                <code>onClick()</code>, does 1 core thing. It flips the direction flag positive or negative each time by a multiplication of -1. Meaning, the next time, -1*-1 will be a positive +1. The next time, +1*-1 will result in -1, thereby inverting the integer 1 each click.
                <code>onRender()</code> follows, drawing the knob in whatever direction plus travel distance (out of scope).
            </p>
            <p>Simply observing the sign (+/-) of direction can tell us implicitly what state this button is in. Since +positive moves to the right and - is a move to the left on a cartesian coordinatte plane, we can use the direction to set a
            custom attribute, like a className such as "on", "off" on the component itself, let's do that.</p>

            <p>
                We'll modify the <code>onClick()</code>, to call <code>onUpdate()</code> which updates this new state.
                 <pre class="inline javascript lang"><code>
onClick(){
    this.direction *= -1;
    this.onUpdate();
    this.onRender();
}
            </code></pre>   
            </p>
            <p>
                <code>onUpdate()</code> will check the direction and add a custom class attributte to the toggle itself:
                  <pre class="inline javascript lang"><code>
onUpdate(){
    (this.direction > 0) ?
        this.classList.add("on"):
        this.classList.remove("on")
    
}
            </code></pre> 
            <p>
                We'll assume that if "on" is not present in the classList, that it is off.
            </p>                 
            </p>
            <!-- <simple-calculator style="margin-top:30px;"></simple-calculator> -->
          </div>
          <div style="width: 50%;display: block;">
            <div class="shell lang"></div>
            <div class="javascript lang">
                <blockquote class="javascript" style="display:block;width: 100%;">
            The ToggleButton class (code hidden for clarity):
          </blockquote>
          <pre class="highlight javascript" style="display:block;width: 100%;"><code>
namespace \`docs.demos.ui\` (
    class ToggleButton extends w3c.ui.WebComponent  {
        onConnected(){
            super.onConnected();
            this.addEventListener("click", e => this.onClick(e));
        }

        onClick(){
            this.direction *= -1;
            this.onRender();
        }

        //other code hidden
    }
)
        </code></pre>
            </div>
            <div class="html lang"></div>
            <div class="css lang"></div>
          </div>
        </div>





    <div style="display: flex;flex-direction: row;flex-wrap: nowrap;">
      <div style="width: 50%;padding: 22px;">
        <h3 id="api-reference">Styling "on" state</h3>
        <p>
          Here's the improved toggle button, inspect it from dev console. Flip it right to left and
          notice the "on" className is being added and removed. We now have a way to style the toggle
          button when it is "on", from it's css declarations:
            <pre class="inline css lang"><code>
toggle-button.on {
    background:limegreen;
}
            </code></pre> 
        </p>
        <p>
            Here's the new improved toggle buttto working:
            <toggle-button-improved></toggle-button-improved>
        </p>
      </div>
      <div style="width: 50%;display: block;">
        <div class="shell lang"></div>
        <div class="javascript lang">
<blockquote class="javascript" style="display:block;width: 100%;">
            From any JavaScript class:
          </blockquote>
          <pre class="highlight javascript" style="display:block;width: 100%;"><code>

namespace \`docs.demos.ui.mods\` (
    class ToggleButtonImproved  extends w3c.ui.WebComponent  {
        onConnected(){
            super.onConnected();
            this.addEventListener("click", e => this.onClick(e));
            this.knob = this.querySelector("div");
            this.direction = -1;
        }

        onStyleComputed(style){//wait for styles
            this.bounds = this.getBoundingClientRect();
            this.knob_bounds = this.knob.getBoundingClientRect();
        }


        onClick(){
            this.direction *= -1;
            this.onUpdate();
            this.onRender();
        }

        onUpdate(){
            (this.direction > 0) ?
                this.classList.add("on"):
                this.classList.remove("on")
        }

        get x() {
            return this.direction > 0 ?
                this.bounds.width-this.knob_bounds.width-6 : 0;
        }

        onRender(){
            var vector = {x: this.x, y:0, z:0 }
            this.knob.style.transform = \`
                translate3d(\${vector.x||0}px, 0px, 0px)
            \`;
        }
    }
)
        </code></pre>
        </div>
        <div class="html lang"></div>
        <div class="css lang">
            <blockquote class="css" style="display:block;width: 100%;">
            From any JavaScript class:
          </blockquote>
          <pre class="highlight css" style="display:block;width: 100%;"><code>
toggle-button-improved.on {
    background: limegreen;
}         
          </code></pre>
        </div>
      </div>
    </div>





    <div style="display: flex;flex-direction: row;flex-wrap: nowrap;">
      <div style="width: 50%;padding: 22px;">
        <h1 id="api-reference">Inter-Sibling Communication</h1>
        <p>doc..in progress</p>
      </div>
      <div style="width: 50%;display: block;">
        <div class="shell lang"></div>
        <div class="javascript lang"></div>
        <div class="html lang"></div>
        <div class="css lang"></div>
      </div>
    </div>

    </div>
</template>
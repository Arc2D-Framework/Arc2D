<template>
  <div>

    



    
    <div style="display: flex;flex-direction: row;flex-wrap: nowrap;" id="intro">
      <div style="width: 50%;padding: 22px;">
        <h1 id="api-reference">Repository Drivers</h1>
        <p>
          By default implementation, repository classes you create inherit from <code>core.data.Repository</code> and are driven by a Memory driver, meaning all data is stored temporarily in browser memory. As soon as the application (browser tab) is closed, the data is lost.
          <img src="src/docs/images/data_access_repositories2.png">
        </p>
        <p>
            This base setup allows you to rapidly prototype and build out core functionality without worrying about creating or defining technical driver details at the early stages of development. The theory goes: You should be able to swap out the driver of your repository for something like a Mongo driver without having to alter code that was written for UI components, it should just work with a different storage device.
        </p>
        <p>In this chapter, we'll explore what the default <code>Memory</code> driver looks like, which is utterly simple. With that piece of knowledge, <em>we'll build a simple Driver for CouchDB</em>, an enterprise-class NoSQL database. We'll then configure our Movies Repository to use the CouchDB driver.</p>
      </div>
      <div style="width: 50%;display: block;">
        <div class="shell lang"></div>
        <div class="javascript lang"></div>
        <div class="html lang"></div>
        <div class="css lang"></div>
      </div>
    </div>





    <div style="display: flex;flex-direction: row;flex-wrap: nowrap;" id="what">
      <div style="width: 50%;padding: 22px;">
        <h1 id="api-reference">What is a Driver?</h1>
        <p>
            Surely you have had the experience of buying and installing a new Printer. Do you recall having to install software on your computer so it knows how to communicate with the printer? That software is a Driver. Each Printer comes with it's own driver.
            <img src="src/docs/images/printer-drivers.png" style="width:100%;margin-top:30px;"/>
        </p>
        <p>
            Installing a printer driver allows the computer to communicate with different printers seamlessly. The Driver collects the data to be printed and encodes/decodes and/or formats it in a particular way that the printer can understand in order to run a print job.
        </p>
        <p>
            By default, the computer is setup usually with some kind of simple generic Driver that works at bare minimum, similar to how Repositories in Arc rely on the Memory driver for storage. The user is able to swap their printer driver for a richer print experience easily, without having to change the way they would print. And that is the core concept of what drivers are at the most lamest of explanations.
        </p>
      </div>
      <div style="width: 50%;display: block;">
        <div class="shell lang"></div>
        <div class="javascript lang"></div>
        <div class="html lang"></div>
        <div class="css lang"></div>
      </div>
    </div>





    <div style="display: flex;flex-direction: row;flex-wrap: nowrap;" id="a-db-problem">
      <div style="width: 50%;padding: 22px;">
        <h1 id="api-reference">A Database Problem</h1>
        <p>
            The biggest challenge when creating your first app, learning, or working in an enterprise team will be data connectivity, the database. Building anything worth while requires storing data. Here, many starting developers especially, make their way down the rabbit hole.
        </p>
      </div>
      <div style="width: 50%;display: block;">
        <div class="shell lang"></div>
        <div class="javascript lang"></div>
        <div class="html lang"></div>
        <div class="css lang"></div>
      </div>
    </div>





    <div style="display: flex;flex-direction: row;flex-wrap: nowrap;" id="memory-driver">
      <div style="width: 50%;padding: 22px;">
        <h1 id="api-reference">The Memory Driver</h1>
        <p>
            To alliviate some of the headache, Arc is configured with a Memory Driver. Use it, don't think about it until you are ready to integrate with an enterprise-class database, then worry about it. This design allows you to focus on app functionality with little to no "throw away" code.
        </p>
        <p>Before we can build a Driver that works with Mongo or CouchDB say, it's worth looking into how the Memory Driver was put together. To the right is the implementation under the Javascript tab.
        </p>
      </div>
      <div style="width: 50%;display: block;">
        <div class="shell lang"></div>
        <div class="javascript lang">
            <blockquote class="javascript" style="display:block;width: 100%;">
            <b>Memory Driver</b>
            Implements the contractual methods/api defined by <code>IStorageInterface</code>
          </blockquote>
          <pre class="highlight javascript" style="display:block;width: 100%;"><code>
import '/framework/src/core/drivers/storage/Cursor.js';
import '/node_modules/od-mingo/dist/mingo.min.js';

/**
   @desc Device for simulating a NoSQL database using
   local memory. Good for development/testing, not for
   use in prod env.
**/
namespace \`core.drivers.storage\` (
    class Memory extends core.drivers.storage.IStorageInterface {
        constructor (collection, storage_device){
            super(collection, storage_device);
            if(!('mingo' in window)) { 
                console.error(this.namespace + " requires npm mingo to be installed.");
            }
            Session.State.db = Session.State.db||{};
            this.setCollection(collection.classname);
        }

        isSeedingEnabled(){
            return true;
        }

        setCollection (name){
            if(typeof Session.State.db[name] != "object"){
                Session.State.db[name] = [];
            }
            this.collection = Session.State.db[name];
        }

        add(obj, cb){
            this.collection.push(obj);
            cb&&cb(obj,null);
            return obj;
        }
        
        find(cb,query){
            query = new mingo.Query(query||{});
            let cursor = query.find(this.collection);
            var c = new core.drivers.storage.Cursor(cursor)
            cb&&cb(c,null);
            return c;
        }

        remove(query, cb){
            query = new mingo.Query(query||{});
            let cursor = query.find(this.collection);
            var c = new core.drivers.storage.Cursor(cursor);
            var res = c.all()||[];
            var removed=[];
            res.forEach(o => {
                for(var i=0; i<=this.collection.length-1; i++){
                    if(this.collection[i]._id == o._id){
                        this.collection.splice(i,1);
                        removed.push(o);
                    }
                }
            });
            cb && cb(removed,null);
            return removed;
        }
    }
)
</code>
      </pre>
        </div>
        <div class="html lang"></div>
        <div class="css lang"></div>
      </div>
    </div>







  </div>
</template>